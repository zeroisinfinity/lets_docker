

[worker.oci]
    enable = true
    platforms = ["linux/amd64" , "linux/arm64"]
    snapshotter = "overlayfs"
    rootless = false
    noProcessSandbox = false

    gc = true
    gckeepgarbage = "5GB"
    reservedSpace = "20%"
    maxUsedSpace = "70%"
    minFreeSpace = "5GB"

    max-parallelism = 6
    cniPoolSize = 20

debug = true
trace = true

root = "/var/lib/buildkit"

insecure-entitlements = ["network.host"]

[log]
    level = "info"
    format = "text"

[dns]
    nameservers = ["1.1.1.1","8.8.8.8","1.0.0.1"]
    options = ["edns0","rotate"]
    searchDomains = ["local"]

[grpc]
    address = ["unix:///run/buildkit/buildkitd.sock"]
    uid = 0
    gid = 0

[worker.oci.labels]
    "environment" = "development"
    "project" = "python-mutliservice"
    "cache-optimization" = "enabled"

# ==================================================================
# CACHE POLICIES - Optimized for Python development workflow
# ==================================================================

[[worker.oci.gcpolicy]]
    reservedSpace = "2GB"       
    maxUsedSpace = "8GB"
    minFreeSpace = "5GB"         
    keepDuration = "168h"        
    filters = [
        "type==exec.cachemount",     
        "type==source.local"         
]

[[worker.oci.gcpolicy]]
reservedSpace = "500MB"     
maxUsedSpace = "2GB"         
keepDuration = "72h"        
filters = [
    "type==exec.cachemount",
    "type==source.git.checkout"
]

[[worker.oci.gcpolicy]]
all = false
reservedSpace = "1GB"
maxUsedSpace = "5GB"
keepDuration = "24h"         
filters = [
    "type==regular"          
]

[registry."docker.io"]
    mirrors = ["mirror.gcr.io"]
    http = false
    insecure = false

# ==================================================================
# FRONTEND CONTROL
# ==================================================================

[frontend."dockerfile.v0"]
    enabled = true

[frontend."gateway.v0"]
    enabled = true
    allowedRepositories = []

[system]
    platformsCacheMaxAge = "2h"

